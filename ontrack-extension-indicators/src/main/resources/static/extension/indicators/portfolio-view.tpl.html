<ot-view>

    <div class="row" ng-show="loadingPortfolio">
        <div class="col-md-12">
            <div class="alert alert-info">
                <span class="ot-loading-indicator"></span>
                Loading the portfolio...
            </div>
        </div>
    </div>

    <div class="row" ng-if="portfolio && portfolio.projects.length == 0">
        <div class="col-md-12">
            <div class="alert alert-info">
                This portfolio does not contain any project.
                <span ng-if="portfolio.links._update && !portfolio.label">
                    In order to associate projects to this portfolio, you need
                    to <a href="#/extension/indicators/portfolios/{{portfolio.id}}/edit">edit this portfolio</a>,
                    set a label and associate some projects to this label.
                </span>
                <span ng-if="portfolio.links._update && portfolio.label">
                    In order to associate projects to this portfolio, you need to associate some projects to
                    the <ot-project-label label="portfolio.label"></ot-project-label> label.
                </span>
            </div>
        </div>
    </div>

    <div class="row" ng-if="portfolio && portfolio.projects.length > 0 && portfolio.categoryStats.length == 0">
        <div class="col-md-12">
            <div class="alert alert-info">
                This portfolio does not contain any category.
                <span ng-if="portfolio.links._update">
                    In order to associate projects to this portfolio, you need
                    to <a href="#/extension/indicators/portfolios/{{portfolio.id}}/edit">edit this portfolio</a>
                    and associate some categories with it.
                </span>
            </div>
        </div>
    </div>

    <table ng-if="portfolio && portfolio.projects.length > 0 && portfolio.categoryStats.length > 0" class="table table-striped">
        <thead>
        <tr>
            <td><b>Projects</b></td>
            <td ng-repeat-start="categoryStats in portfolio.categoryStats" style="width: 36px;">
                <ot-extension-indicators-status status="categoryStats" size="md"></ot-extension-indicators-status>
            </td>
            <td ng-repeat-end>
                <p><b>{{categoryStats.category.name}}</b></p>
                <p ng-if="categoryStats.stats.total > 0">
                    {{categoryStats.stats.count}}/{{categoryStats.stats.total}} indicator<span
                        ng-if="categoryStats.stats.count > 1">s</span> <span
                        ng-if="categoryStats.stats.count > 1">are</span><span
                        ng-if="categoryStats.stats.count <= 1">is</span> rated.
                </p>
                <p ng-if="categoryStats.stats.total == 0">
                    No indicator has been rated for this portfolio.
                </p>
                <p ng-if="categoryStats.stats.minRating != categoryStats.stats.avgRating">
                    {{categoryStats.stats.minCount}} indicator<span ng-if="categoryStats.stats.minCount > 1">s</span>
                    <span ng-if="categoryStats.stats.minCount > 1">are</span><span
                        ng-if="categoryStats.stats.minCount <= 1">is</span> rated
                    <ot-extension-indicators-status
                            status="{compliance: categoryStats.stats.min, rating: categoryStats.stats.minRating }"
                            size="sm"></ot-extension-indicators-status>
                </p>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="project in portfolio.projects">
            <td>
                <a href="{{project.links._page}}" title="Project page">{{project.name}}</a>
                <a href="#/extension/indicators/project-indicators/{{project.id}}" title="Manage the project indicators for the {{project.name}} project"><span class="fa fa-pencil ot-command"></span></a>
            </td>
            <td ng-repeat-start="projectCategory in project.projectIndicators.categories" style="width: 36px;">
                <ot-extension-indicators-status status="projectCategory.stats" size="md"></ot-extension-indicators-status>
            </td>
            <td ng-repeat-end>
            </td>
        </tr>
        </tbody>
    </table>

</ot-view>